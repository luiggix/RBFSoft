
#ifndef _KNOTS2D_HPP_
#define _KNOTS2D_HPP_

#include <fstream>
#include <vector>
#include "Traits.hpp"
#include "kdtree++/kdtree.hpp"

/*!
 ***************************************************************************
 *  The leaves of the KDTree in 2D.
 *  Objects of this structure are used by kdtree++ as the leaves of the 
 *  complete KDTree. It requires some particular behavior, explained in 
 *  http://libkdtree.alioth.debian.org/
 *  \author Luis M. de la Cruz [ Mon Dec 17 10:30:21 GMT 2007 ]
 ***************************************************************************
 */
struct knot2D 
{    
    prec_t coord[2]; ///< (x,y) knots coordinates in 2D.
    int index; ///< index inside the global Matrix, used for the ACBFprecond.
/*!
 *  Overloaded [ ] operator required by kdtree++ to access the individual
 *  dimensional components.
 *  \param N the dimensional component.
 */
    inline prec_t operator[](size_t const N) const { return coord[N]; }
};
/*!
 *  Comparison, needed by kdtree++
 */
inline bool operator==(knot2D const& A, knot2D const& B) 
{
    return A.coord[0] == B.coord[0] && A.coord[1] == B.coord[1];
}
/*!
 *  Simple output operator overloading (<<)
 */ 
std::ostream& operator<<(std::ostream& out, knot2D const& T)
{
    return out << T.coord[0] << "\t" << T.coord[1] << "\n";
}
/*!
 *  Function needed by kdtree++.
 */
prec_t tac( knot2D t, int k ) { return t[k]; }
/*!
 *  KDTree type definition in 2D.
 */
typedef 
KDTree::KDTree<2, 
	       knot2D, 
	       std::pointer_to_binary_function<knot2D, 
					       int, 
					       prec_t> >  tree2D_t;
//
//  Declaration of a tree and the array of nearest neigbohrs, 
//  these variables will be used in several functions of Knots class,
//  specially in Knots::kdtree() and  Knots::findNeighborsAll().
//
tree2D_t tree(std::ptr_fun(tac)); // Tree to store all knots in 2D. 
std::vector<knot2D> neighbors_array; // Array of neighbors.
std::vector<knot2D>::const_iterator neighbors_i; // Iterator.

#endif // _KNOTS2D_HPP_
